<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>Owner Inspection — Year/Month with Fixed Section Donuts</title>
<link rel="icon" href="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 64 64'%3E%3Crect width='64' height='64' rx='12' fill='%23111827'/%3E%3Cpath fill='%23FFD166' d='M14 42h36v6H14zM18 16h28a6 6 0 016 6v14H12V22a6 6 0 016-6z'/%3E%3Ccircle cx='22' cy='25' r='3' fill='%2306D6A0'/%3E%3Ccircle cx='32' cy='25' r='3' fill='%23FFD166'/%3E%3Ccircle cx='42' cy='25' r='3' fill='%23EF476F'/%3E%3C/svg%3E"/>
<style>
:root{
  --bg:#fff;--ink:#111827;--muted:#6B7280;--line:#E5E7EB;--brand:#1F2937;
  --ring:#EAEFF5;--ok:#10B981;--warn:#F59E0B;--bad:#EF4444;--neutral:#94A3B8;
}
*{box-sizing:border-box}
html{scroll-behavior:smooth}
body{margin:0;background:var(--bg);color:var(--ink);font-family:Inter,ui-sans-serif,system-ui,-apple-system,Segoe UI,Roboto}
.wrap{max-width:1200px;margin:0 auto;padding:20px 20px 80px}
.header{display:flex;align-items:center;justify-content:space-between;gap:16px;position:sticky;top:0;background:#fff;border-bottom:1px solid var(--line);padding:10px 0;z-index:10}
.h-left{display:flex;align-items:baseline;gap:12px}
.h-title{font-weight:900;font-size:18px;color:var(--brand)}
.h-sub{color:var(--muted);font-size:12px}
.controls{display:flex;gap:10px;flex-wrap:wrap;align-items:center}
select{border:1px solid var(--line);border-radius:8px;padding:8px 10px;font-size:12px}
.btn{background:#fff;border:1px solid var(--line);border-radius:8px;padding:8px 10px;font-size:12px;color:var(--brand);cursor:pointer}
.btn.primary{background:var(--brand);color:#fff;border-color:var(--brand)}
.kpi-grid{display:grid;grid-template-columns:repeat(3,1fr);gap:12px;margin-top:12px}
.kpi{display:grid;grid-template-columns:110px 1fr;gap:10px;align-items:center;border:1px solid var(--line);border-radius:12px;padding:12px;background:#fff}
.kpi .donut{width:100px;height:100px}
.kpi .info{display:flex;flex-direction:column}
.kpi .label{font-size:12px;color:var(--muted);font-weight:700}
.kpi .value{font-size:20px;font-weight:900}
.tiles{display:grid;grid-template-columns:repeat(5,1fr);gap:14px;margin-top:14px}
.tile{display:flex;flex-direction:column;align-items:center;border:1px solid var(--line);border-radius:12px;padding:12px;background:#fff;text-decoration:none;color:inherit;transition:box-shadow .2s ease, transform .15s ease}
.tile:hover{box-shadow:0 8px 24px rgba(0,0,0,.06);transform:translateY(-1px)}
.tile .name{font-weight:800;margin-top:6px}
.tile .pill{font-size:11px;margin-top:6px;padding:3px 7px;border-radius:999px;border:1px solid var(--line)}
.pill.ok{background:#ECFDF5;color:#065F46;border-color:#A7F3D0}
.pill.bad{background:#FEF2F2;color:#991B1B;border-color:#FECACA}
.pill.na{background:#F3F4F6;color:#374151;border-color:#E5E7EB}
.section{margin:18px 0}
.sec-title{font-weight:900;border-left:4px solid #111827;padding-left:10px;margin:6px 0 10px}
.gallery{display:grid;grid-template-columns:repeat(4,1fr);gap:8px}
.ph{margin:0;border:1px solid var(--line);border-radius:10px;overflow:hidden;background:#fff;position:relative}
.ph img,.ph iframe{width:100%;height:160px;object-fit:cover;display:block;border:0}
.ph figcaption{font-size:11px;color:#6B7280;padding:6px 8px;display:flex;justify-content:space-between;gap:6px}
.cap-left{white-space:nowrap;overflow:hidden;text-overflow:ellipsis}
.cap-right{color:#374151;white-space:nowrap}
.small{font-size:12px;color:var(--muted)}
.donut{width:72px;height:72px}
.tile svg text{font-size:6px;font-weight:800;fill:#111827}

/* Owner feedback styles */
.feedback{border:1px solid var(--line);border-radius:12px;background:#fff;padding:14px}
.feedback .row{display:flex;gap:10px;align-items:flex-start}
.feedback textarea{flex:1;resize:vertical;min-height:90px;padding:10px;border:1px solid var(--line);border-radius:10px;font-size:14px}
.feedback .meta{display:flex;gap:8px;align-items:center;color:var(--muted);font-size:12px;margin-top:6px}
.feedback .char{margin-left:auto}

/* Lightbox */
#lightbox{position:fixed;inset:0;background:rgba(17,24,39,.8);display:none;align-items:center;justify-content:center;z-index:50}
#lightbox img{max-width:92vw;max-height:88vh;border-radius:12px;box-shadow:0 12px 40px rgba(0,0,0,.35)}
#lightbox.closezone{cursor:zoom-out}

/* Responsive */
@media (max-width:1000px){.tiles{grid-template-columns:repeat(3,1fr)}.gallery{grid-template-columns:repeat(3,1fr)}}
@media (max-width:700px){.tiles{grid-template-columns:repeat(2,1fr)}.gallery{grid-template-columns:repeat(2,1fr)}}
@media (max-width:460px){.tiles{grid-template-columns:1fr}.gallery{grid-template-columns:1fr}}
</style>
<script>
var DATA = [{ 
    section: "Internal Handyman Inspection",
    passes: 82,
    fails: 6,
    total: 88,
    inspectionsMade: 1
}];
</script>
</head>
<body>
  <div class="wrap">
    <div class="header">
      <div class="h-left">
        <div class="h-title">Owner Inspection — Year / Month</div>
        <div class="h-sub small" id="summaryDate"></div>
      </div>
      <div class="controls">
        <select id="year" title="Year"></select>
        <select id="month" title="Month"></select>
        <button id="applyYM" class="btn">Apply</button>
      </div>
    </div>

    <section id="tiles" class="tiles"></section>

    <section id="photos" class="section">
      <div class="sec-title">Photos (Selected Year/Month)</div>
      <div id="photoSections"></div>
    </section>

    <!-- Owner comments & feedback -->
    <section id="ownerFeedback" class="section">
      <div class="sec-title">Owner Comments &amp; Feedback</div>
      <div class="feedback">
        <div class="row">
          <textarea id="feedbackText" placeholder="Write your feedback here…"></textarea>
          <button id="sendFeedback" class="btn primary">Send</button>
        </div>
        <div class="meta">
          <span>We read every message.</span>
          <span class="char" id="charCount">0 / 1000</span>
        </div>
      </div>
    </section>
  </div>

  <div id="lightbox" class="closezone" aria-hidden="true"><img alt="Preview"/></div>

<script>
// --- Data (as provided) -----------------------------------------------------
const DATA = [{"timestamp": "2025-08-05T14:35:31.667000", "year": 2025, "month": 8, "sections": {"Living": {"total": 14, "passes": 14, "fails": 0}, "Kitchen": {"total": 38, "passes": 38, "fails": 0}, "Bedroom": {"total": 70, "passes": 70, "fails": 0}, "Systems": {"total": 7, "passes": 7, "fails": 0}, "Lock & Leave": {"total": 5, "passes": 5, "fails": 0}}, "overall": {"total": 134, "passes": 134, "fails": 0, "rate": 100.0}, "photos": {"Living": [{"url": "https://drive.google.com/uc?export=view&id=1hmDrSM8hGT0JqY3OtynBUVLhlNII556f", "ts": "2025-08-05T14:35:31.667000"}, {"url": "https://drive.google.com/uc?export=view&id=1TNJqKZcF5nyIfJsZYqje1yCgqLQKM4xM", "ts": "2025-08-05T14:35:31.667000"}, {"url": "https://drive.google.com/uc?export=view&id=1Byvu2erW15kqybBUk2ZEC0GKiiAbc6Qc", "ts": "2025-08-05T14:35:31.667000"}, {"url": "https://drive.google.com/uc?export=view&id=1fntDPJHGDUwgBWst9FHZ2OvaeQA9csMo", "ts": "2025-08-05T14:35:31.667000"}, {"url": "https://drive.google.com/uc?export=view&id=1TnZyNfXmf6e5bISkPZtSeeR6sPL7YMHW", "ts": "2025-08-05T14:35:31.667000"}], "Kitchen": [{"url": "https://drive.google.com/uc?export=view&id=1jgFzVSVBBJ2w90olqbWlAoH_W8keNlPe", "ts": "2025-08-05T14:35:31.667000"}, {"url": "https://drive.google.com/uc?export=view&id=1xJH1wRbu0ofkA01legOufNxXb4JdZPXy", "ts": "2025-08-05T14:35:31.667000"}, {"url": "https://drive.google.com/uc?export=view&id=1xXwXd53HidUW1BJH5trb0O-ZlZrIClZp", "ts": "2025-08-05T14:35:31.667000"}, {"url": "https://drive.google.com/uc?export=view&id=1Jy71yHn-NnrZbim_1SWmVFU_Z6SeGNEM", "ts": "2025-08-05T14:35:31.667000"}, {"url": "https://drive.google.com/uc?export=view&id=1DxIVT12MLNR2kCerOu2DzRgPclIkGQCy", "ts": "2025-08-05T14:35:31.667000"}], "Bedroom": [{"url": "https://drive.google.com/uc?export=view&id=177n9N5VHwC3kWKhdYYiE9-daQZXGED_d", "ts": "2025-08-05T14:35:31.667000"}, {"url": "https://drive.google.com/uc?export=view&id=1JZeaLzv9DhDvdzdgaiz5QZR5xWEuxbJD", "ts": "2025-08-05T14:35:31.667000"}, {"url": "https://drive.google.com/uc?export=view&id=1cF3uX5crzlb1I66ELLoHA3zYCZ5cCaXE", "ts": "2025-08-05T14:35:31.667000"}, {"url": "https://drive.google.com/uc?export=view&id=1JTw5XihxSGcH8w_BovZzzZkN0uXaYaQ6", "ts": "2025-08-05T14:35:31.667000"}, {"url": "https://drive.google.com/uc?export=view&id=1EXjDokdw5hlcvgGhb3n7goMLd-cnllNJ", "ts": "2025-08-05T14:35:31.667000"}, {"url": "https://drive.google.com/uc?export=view&id=1qgfkHy7gDU6gKDenrwtF-IPRspmGYXcS", "ts": "2025-08-05T14:35:31.667000"}, {"url": "https://drive.google.com/uc?export=view&id=1FQGGcUJxhYmZJNm0-QGnWWmgGDsGG_o3", "ts": "2025-08-05T14:35:31.667000"}, {"url": "https://drive.google.com/uc?export=view&id=1pzE07byiff-_O9O88UTF-4f-CcX53UEL", "ts": "2025-08-05T14:35:31.667000"}, {"url": "https://drive.google.com/uc?export=view&id=17KlhzzPT6-BhsqZB4aCN1VIlVYp4ZVUM", "ts": "2025-08-05T14:35:31.667000"}, {"url": "https://drive.google.com/uc?export=view&id=1t9yp8febK3RCCBDqUzrCz_IKjH46yJPX", "ts": "2025-08-05T14:35:31.667000"}, {"url": "https://drive.google.com/uc?export=view&id=1GPnYqiFiYvcXzNme3texUqEkF9GfJePN", "ts": "2025-08-05T14:35:31.667000"}, {"url": "https://drive.google.com/uc?export=view&id=1jG86VgFi0ee8JKrthtOzIKSUBKUDFL8Y", "ts": "2025-08-05T14:35:31.667000"}, {"url": "https://drive.google.com/uc?export=view&id=1XVHAvfQh2cWw4uZB6UE_a15VroSxuxwj", "ts": "2025-08-05T14:35:31.667000"}, {"url": "https://drive.google.com/uc?export=view&id=1RJs2lU9OxHaoHWKUZG_MYW3GhMTKsw_V", "ts": "2025-08-05T14:35:31.667000"}, {"url": "https://drive.google.com/uc?export=view&id=1aqx_XoF0k0E6bRD5p_S_DbgPTFXcF03d", "ts": "2025-08-05T14:35:31.667000"}, {"url": "https://drive.google.com/uc?export=view&id=18TRuQMKNdWwqh_VkMBfBrwlum13krZtq", "ts": "2025-08-05T14:35:31.667000"}, {"url": "https://drive.google.com/uc?export=view&id=1dRW4P_LcHBU4kfScP94lSh-6pOkpigdf", "ts": "2025-08-05T14:35:31.667000"}], "Systems": [{"url": "https://drive.google.com/uc?export=view&id=1JVoZnEzYMgZDdwp8--HL-V4cKPWlHlRQ", "ts": "2025-08-05T14:35:31.667000"}, {"url": "https://drive.google.com/uc?export=view&id=1N9kbUuK7QFO4JPKvl2Dir-Bm5SwXP3If", "ts": "2025-08-05T14:35:31.667000"}, {"url": "https://drive.google.com/uc?export=view&id=1Lu9cxEPuCmw22CFR-KnBIVRv0nfoDphX", "ts": "2025-08-05T14:35:31.667000"}, {"url": "https://drive.google.com/uc?export=view&id=1BjMhdtOiFXI_WbbR6i6mqqQA_UxVCBDK", "ts": "2025-08-05T14:35:31.667000"}, {"url": "https://drive.google.com/uc?export=view&id=1zihNFkh6XRl6u5rOkoTKEn7OWwpjwsKj", "ts": "2025-08-05T14:35:31.667000"}, {"url": "https://drive.google.com/uc?export=view&id=1W6hJsLzUs3MAjBq_gkYBieJ9c7wvbyf4", "ts": "2025-08-05T14:35:31.667000"}, {"url": "https://drive.google.com/uc?export=view&id=1ynv9dGZU8XveuJhsvbyuwWqbid6cjdUF", "ts": "2025-08-05T14:35:31.667000"}, {"url": "https://drive.google.com/uc?export=view&id=1R4iKbFLp3g8JjCXDBjN_6-xCBY41xn43", "ts": "2025-08-05T14:35:31.667000"}, {"url": "https://drive.google.com/uc?export=view&id=1_n--jFCYKGesH5YgaHdJZKNypIdx9SwZ", "ts": "2025-08-05T14:35:31.667000"}, {"url": "https://drive.google.com/uc?export=view&id=1LYNZOlGphl9_OpoZKhcIvW5gy6XBeLTX", "ts": "2025-08-05T14:35:31.667000"}, {"url": "https://drive.google.com/uc?export=view&id=1lAH86OZEbklOXH5V-gkqnlMZJh7qOLfw", "ts": "2025-08-05T14:35:31.667000"}, {"url": "https://drive.google.com/uc?export=view&id=1ft0p2cR0mgiZSK37_cd-XfG5bUAzTcZl", "ts": "2025-08-05T14:35:31.667000"}, {"url": "https://drive.google.com/uc?export=view&id=1aXPxy6T-FvSMZr7ssjWkQZ0DkP96mb2D", "ts": "2025-08-05T14:35:31.667000"}], "Lock & Leave": [{"url": "https://drive.google.com/uc?export=view&id=1LTU8NQ3lS3Tj7HLsYfV6RWcxQyUZ2Kqc", "ts": "2025-08-05T14:35:31.667000"}]}}];
const YEARS = [2025];
const MONTHS_BY_YEAR = {"2025": [8]};

// --- Helpers ----------------------------------------------------------------
function safePct(x){ const v = Number.isFinite(x) ? x : 0; return Math.max(0, Math.min(100, Math.round(v))); }

function aggregate(rows){
  const agg={overall:{total:0,passes:0,fails:0}, sections:{}, photos:{}};
  rows.forEach(r=>{
    agg.overall.total += r.overall.total;
    agg.overall.passes += r.overall.passes;
    agg.overall.fails += r.overall.fails;
    for(const [sec,v] of Object.entries(r.sections)){
      if(!agg.sections[sec]) agg.sections[sec]={total:0,passes:0,fails:0};
      agg.sections[sec].total+=v.total; agg.sections[sec].passes+=v.passes; agg.sections[sec].fails+=v.fails;
    }
    for(const [sec,items] of Object.entries(r.photos||{})){
      if(!agg.photos[sec]) agg.photos[sec]=[];
      agg.photos[sec].push(...items);
    }
  });
  agg.overall.rate = agg.overall.total? (agg.overall.passes/agg.overall.total*100):0;
  return agg;
}

function strokeForRate(rate){
  if(rate===null) return getComputedStyle(document.documentElement).getPropertyValue('--neutral')||'#94A3B8';
  if(rate>=90) return '#10B981'; // green
  if(rate>=75) return '#F59E0B'; // amber
  return '#EF4444'; // red
}

function renderTiles(agg){
  const tiles=document.getElementById('tiles');
  tiles.innerHTML='';
  // Optional: custom order instead of pure alpha
  const order = ['Living','Bedroom','Kitchen','Systems','Lock & Leave'];
  const secs = Object.keys(agg.sections).sort((a,b)=>{
    const ia = order.indexOf(a), ib = order.indexOf(b);
    if(ia!==-1 && ib!==-1) return ia-ib; if(ia!==-1) return -1; if(ib!==-1) return 1; return a.localeCompare(b);
  });
  secs.forEach(sec=>{
    const s=agg.sections[sec];
    const total = s.total || 0;
    const passes = s.passes || 0;
    const fails  = s.fails  || 0;
    const rate = total ? Math.round((passes/total)*100) : null; // null => No Data
    const pill = total === 0
      ? '<span class="pill na">No data</span>'
      : (fails>0 ? '<span class="pill bad">'+fails+' issue'+(fails>1?'s':'')+'</span>' : '<span class="pill ok">Clear</span>');
    const dash = rate===null ? '0,100' : rate+','+(100-rate);
    const center = rate===null ? 'No Data' : (rate+'%');
    const stroke = strokeForRate(rate);

    const tile=document.createElement('a'); tile.className='tile'; tile.href='#sec-'+sec.replace(/\s+/g,'-').toLowerCase();
    tile.innerHTML=`
      <svg class="donut" viewBox="0 0 36 36" role="img" aria-label="${sec} ${passes}/${total} passed, ${fails} failed">
        <title>${sec}: ${passes}/${total} passed · ${fails} failed</title>
        <circle cx="18" cy="18" r="15.915" fill="none" stroke="${CSS.escape(getComputedStyle(document.documentElement).getPropertyValue('--ring')||'#EAEFF5')}" stroke-width="3.8"></circle>
        <circle cx="18" cy="18" r="15.915" fill="none" stroke="${stroke}" stroke-width="3.8" stroke-linecap="round" stroke-dasharray="${dash}"></circle>
        <text x="18" y="20" text-anchor="middle">${center}</text>
      </svg>
      <div class="name">${sec}</div>
      ${pill}`;
    tiles.appendChild(tile);
  });
}

function toDrivePreview(u){
  try{
    if(!u.includes('drive.google.com')) return null;
    const m = u.match(/\/file\/d\/([^/]+)\//);
    let id = m ? m[1] : null;
    if(!id){
      const url = new URL(u);
      id = url.searchParams.get('id');
    }
    return id ? ('https://drive.google.com/file/d/'+id+'/preview') : null;
  }catch(e){ return null; }
}

function renderPhotos(agg){
  const wrap=document.getElementById('photoSections');
  wrap.innerHTML='';
  const secs=Object.keys(agg.photos).sort();
  secs.forEach(sec=>{
    const id='sec-'+sec.replace(/\s+/g,'-').toLowerCase();
    const secDiv=document.createElement('div'); secDiv.className='section'; secDiv.id=id;
    secDiv.innerHTML=`<div class="sec-title">${sec}</div>`;
    const g=document.createElement('div'); g.className='gallery';
    (agg.photos[sec]||[]).slice(0,60).forEach(item=>{
      const url = item.url, ts = item.ts;
      const fig=document.createElement('figure'); fig.className='ph';
      const img=document.createElement('img'); img.alt=sec+' photo'; img.loading='lazy'; img.referrerPolicy='no-referrer'; img.src=url;
      img.onerror=()=>{
        const preview = toDrivePreview(url);
        if(preview){
          const ifr = document.createElement('iframe'); ifr.loading='lazy'; ifr.src=preview; fig.appendChild(ifr);
          img.remove();
        } else {
          const a=document.createElement('a'); a.href=url; a.target='_blank'; a.textContent='Open Photo'; img.replaceWith(a);
        }
      };
      img.addEventListener('click',()=>openLightbox(url));
      const cap=document.createElement('figcaption');
      const left=document.createElement('span'); left.className='cap-left'; left.textContent=sec;
      const right=document.createElement('span'); right.className='cap-right'; right.textContent=new Date(ts).toLocaleString();
      cap.appendChild(left); cap.appendChild(right);
      fig.appendChild(img); fig.appendChild(cap); g.appendChild(fig);
    });
    secDiv.appendChild(g); wrap.appendChild(secDiv);
  });
}

function applyYearMonth(){
  const y = parseInt(document.getElementById('year').value,10);
  const m = parseInt(document.getElementById('month').value,10);
  const rows = DATA.filter(r=> r.year===y && r.month===m);
  const agg = aggregate(rows);
  // Header date label
  const label = rows.length ? new Date(rows[rows.length-1].timestamp).toLocaleString(undefined,{year:'numeric',month:'long'}) : 'No data';
  document.getElementById('summaryDate').textContent = label;
  // Render
  renderTiles(agg);
  renderPhotos(agg);
}

function populateYearMonth(){
  const ySel = document.getElementById('year');
  const mSel = document.getElementById('month');
  ySel.innerHTML='';
  YEARS.forEach(y=>{
    const opt=document.createElement('option'); opt.value=y; opt.textContent=y; ySel.appendChild(opt);
  });
  ySel.value = YEARS[YEARS.length-1];
  function fillMonths(y){
    mSel.innerHTML='';
    const months = (MONTHS_BY_YEAR[String(y)] || []).sort((a,b)=>a-b);
    months.forEach(m=>{
      const opt=document.createElement('option');
      opt.value=m;
      const name=new Date(2000,m-1,1).toLocaleString(undefined,{month:'long'});
      opt.textContent=name;
      mSel.appendChild(opt);
    });
    if(months.length){ mSel.value = months[months.length-1]; }
  }
  fillMonths(ySel.value);
  ySel.addEventListener('change', ()=>{ fillMonths(ySel.value); applyYearMonth(); });
  mSel.addEventListener('change', applyYearMonth);
}

// --- Feedback handling ------------------------------------------------------
const MAX_CHARS = 1000;
function setupFeedback(){
  const ta = document.getElementById('feedbackText');
  const counter = document.getElementById('charCount');
  const btn = document.getElementById('sendFeedback');
  function updateCount(){ counter.textContent = (ta.value.length)+" / "+MAX_CHARS; if(ta.value.length>MAX_CHARS){ ta.value = ta.value.slice(0,MAX_CHARS);} }
  ta.addEventListener('input', updateCount); updateCount();
  btn.addEventListener('click', async ()=>{
    const text = ta.value.trim();
    if (!text){ alert('Please enter your feedback first.'); return; }
    // If you have a backend endpoint, define window.FEEDBACK_ENDPOINT = 'https://…' before this script.
    if(window.FEEDBACK_ENDPOINT){
      try{
        await fetch(window.FEEDBACK_ENDPOINT,{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({message:text, at:new Date().toISOString()})});
        alert('Thank you! Your feedback has been submitted.');
        ta.value=''; updateCount();
        return;
      }catch(err){ console.error(err); }
    }
    // Fallback: store locally so nothing is lost.
    const key = 'ownerFeedbackLog';
    const arr = JSON.parse(localStorage.getItem(key)||'[]');
    arr.push({message:text, at:new Date().toISOString()});
    localStorage.setItem(key, JSON.stringify(arr));
    alert('Saved locally (no backend configured). Set FEEDBACK_ENDPOINT to forward to your system.');
    ta.value=''; updateCount();
  });
}

// --- Simple Lightbox --------------------------------------------------------
function openLightbox(src){
  const lb = document.getElementById('lightbox');
  lb.querySelector('img').src = src; lb.style.display='flex';
}
window.addEventListener('click', (e)=>{
  const lb = document.getElementById('lightbox');
  if(e.target===lb){ lb.style.display='none'; lb.querySelector('img').src=''; }
});
window.addEventListener('keydown',(e)=>{
  if(e.key==='Escape'){ const lb=document.getElementById('lightbox'); if(lb.style.display==='flex'){ lb.style.display='none'; lb.querySelector('img').src=''; } }
});

// --- Init -------------------------------------------------------------------
document.getElementById('applyYM').addEventListener('click', applyYearMonth);
(function init(){
  populateYearMonth();
  applyYearMonth();
  setupFeedback();
})();
</script>
</body>
</html>
